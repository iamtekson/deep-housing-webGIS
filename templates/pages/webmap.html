{% extends "base.html" %}
{% load static %}
{% block title %} Webmap {% endblock title %}

{% block content %}
<!-- map view -->
<h1 class="title" leaflet-browser-print-content style="display: none;">Utility Management System: Deep Housing</h1>
<div id="map"></div>

{% include "map-control/_navbar.html" %}

{% include "map-control/functions.html" %}

{% include "map-control/add-vector.html" %}

{% include "map-control/share.html" %}

{% include "map-control/about.html" %}

{% include "map-control/side-control.html" %}

{% include "map-control/coordinate.html" %}

{% endblock content %}

{% block js %}
<script>

    var waterNetworkStyle = {
        stroke: '#452',
        color: '#579fbe',
        weight: 1
    },
        boundaryStyle = {
            color: '#777',
            weight: .7,
            fill: false
        },
        boundarybuildingStyle = {
            color: 'red',
            weight: 0.5,
        },
        parkStyle = {
            color: 'green',
            weight: 1,
            fill: 'green',
        },
        swimmingpollStyle = {
            color: 'blue',
            weight: .5,
            fill: 'blue'
        },
        templeStyle = {
            color: 'red',
            weight: .5,
            fill: 'red',
        },
        houseStyle = {
            color: 'green',
            fill: 'red',
            weight: 3,
        },
        sanitaryStyle = {
            color: 'yellow',
            weight: 1
        },
        sanitaryjunctionpointStyle = {
            radius: 4,
            color: 'black',
            fillColor: 'red',
            weight: 1,
            opacity: 1,
            fillOpacity: .8,
        }, 
        roadStyle = {
            color: 'red',
            weight: 2,
            dashArray: '5,10'
        },
        electricalLine={
            color: 'blue',
            weight: 1,
        },
        telephoneStyle = {
            color: 'green',
            weight:1
        }

    function otherLayers() {
        $.getJSON("{% url 'boundary' %}", function (data) {
            var boundary1 = L.geoJSON(data, {
                style: boundaryStyle,
            }).addTo(map);
            var layer = new L.layerGroup().addLayer(boundary1),
                selector = $('.boundary')
            layerToggler(selector, layer)
        });
        $.getJSON("{% url 'boundarybuilding' %}", function (data) {
            var boundarybuilding1 = L.geoJSON(data, {
                style: boundarybuildingStyle
            }).addTo(map);
            var layer = new L.layerGroup().addLayer(boundarybuilding1)
            selector = $('.boundary-building')
            layerToggler(selector, layer)
        });
        $.getJSON("{% url 'park' %}", function (data) {
            let park = L.geoJSON(data, {
                style: parkStyle
            }).addTo(map);
            let selector = $('.park'),
                layer = new L.layerGroup().addLayer(park)
            layerToggler(selector, layer)
        });
        $.getJSON("{% url 'swimmingpool' %}", function (data) {
            let swimmingpool = L.geoJSON(data, {
                style: swimmingpollStyle
            }).addTo(map);
            let selector = $('.swimming-pool'),
                layer = new L.layerGroup().addLayer(swimmingpool)
            layerToggler(selector, layer)
        });
        $.getJSON("{% url 'temple' %}", function (data) {
            let temple = L.geoJSON(data, {
                style: templeStyle
            }).addTo(map);
            let selector = $('.temple'),
                layer = new L.layerGroup().addLayer(temple)
            layerToggler(selector, layer)
        });
    }
    otherLayers()

    // Water layer manage
    function waterLayer() {
        $.getJSON("{% url 'waternetwork' %}", function (data) {
            var waterNetwork1 = L.geoJSON(data, {
                style: waterNetworkStyle,
                onEachFeature: function (feature, layer) {
                    layer.on({
                        click: function (e) {
                            popupContents(e);
                            $('.sidebar-info').html(`<h4>Water Network</h4>
                            <div class="container"><table class="table table-striped">
                            <thead><tr><th>Properties</th><th>Value</th></tr></thead>
                            <tbody><tr><td> Type </td><td> ${feature.properties.line_type}</td></tr>
                            <tr><td> Pipe diameter(cm) </td><td>${feature.properties.pip_dia_in}</td></tr>`)
                        }
                    })
                },
            });
            var waterNetwork = new L.layerGroup().addLayer(waterNetwork1)
            $(".water-supply").click(function () {
                if ($(this).prop('checked') == true) {
                    map.addLayer(waterNetwork);
                } else if ($(this).prop('checked') == false) {
                    map.removeLayer(waterNetwork);
                }
            });
        })
    }
    waterLayer()


    //house dataset
    $.getJSON("{% url 'house' %}", function (data) {
        var houselayer1 = L.geoJSON(data, {
            style: houseStyle,
            onEachFeature: function (feature, layer) {
                layer.on({
                    click: function (e) {
                        popupContents(e);
                        $('.sidebar-info').html(`<h4>Building</h4>
                            <div class="container"><table class="table table-striped">
                            <thead><tr><th>Properties</th><th>Value</th></tr></thead>
                            <tbody><tr><td> id </td><td> ${feature.properties.pk}</td></tr>
                            <tr><td> Current Resident </td><td>${feature.properties.curr_resid}</td></tr>
                            <tr><td> House type </td><td>${feature.properties.house_type}</td></tr>
                            <tr><td> Area (sq.m) </td><td>${feature.properties.area_sq_m_field}</td></tr>
                            <tr><td> Permanent </td><td>${feature.properties.permanent}</td></tr>
                            <tr><td> Plot number </td><td>${feature.properties.plot_no}</td></tr>`)

                    }
                })
            }
        }).addTo(map);
        var layer = new L.layerGroup().addLayer(houselayer1),
            selector = $('.building')
        layerToggler(selector, layer)
    })


    //sanitary layer
    $.getJSON("{% url 'sanitary' %}", function (data) {
        var sanitary = L.geoJSON(data, {
            style: sanitaryStyle,
            onEachFeature: function (feature, layer) {
                layer.on({
                    click: function (e) {
                        popupContents(e);
                        $('.sidebar-info').html(`<h4>Sanitary</h4>
                            <div class="container"><table class="table table-striped">
                            <thead><tr><th>Properties</th><th>Value</th></tr></thead>
                            <tbody><tr><td> id </td><td> ${feature.properties.pk}</td></tr>
                            <tr><td> Type </td><td>${feature.properties.type}</td></tr>
                            <tr><td> Pipe Material </td><td>${feature.properties.pipe_mat}</td></tr>
                            <tr><td> Diameter of Pipe (cm) </td><td>${feature.properties.diamr_mm_field}</td></tr>
                            <tr><td> Trench Depth </td><td>${feature.properties.trench_dep}</td></tr>`)

                    }
                })
            }
        }).addTo(map);
        //sanitary junction point
        $.getJSON("{% url 'sanitaryjunctionpoint' %}", function (data) {
            let sanitaryjunctionpoint = L.geoJSON(data, {
                pointToLayer: function (feature, latlng) {
                    return L.circleMarker(latlng, sanitaryjunctionpointStyle);
                }
            }).addTo(map);
            sanitaryjunctionpoint.addTo(sanitary)
            var layer = new L.layerGroup().addLayer(sanitary),
                selector = $('.sanitary')
            layerToggler(selector, layer)
        })
    })

//Road Network
    $.getJSON("{% url 'road' %}", function (data) {
        var road = L.geoJSON(data, {
            style: roadStyle,
            onEachFeature: function (feature, layer) {
                layer.on({
                    click: function (e) {
                        popupContents(e);
                        $('.sidebar-info').html(`<h4>Road</h4>
                            <div class="container"><table class="table table-striped">
                            <thead><tr><th>Properties</th><th>Value</th></tr></thead>
                            <tbody><tr><td> id </td><td> ${feature.properties.pk}</td></tr>
                            <tr><td> Current Road Type </td><td>${feature.properties.road_type}</td></tr>
                            <tr><td> Road Segment </td><td>${feature.properties.road_typ_1}</td></tr>`)

                    }
                })
            }
        }).addTo(map);
        var layer = new L.layerGroup().addLayer(road),
            selector = $('.road-network')
        layerToggler(selector, layer)
    })

//electrical line
$.getJSON("{% url 'electrical' %}", function (data) {
        var electrical = L.geoJSON(data, {
            style: electricalLine,
            onEachFeature: function (feature, layer) {
                layer.on({
                    click: function (e) {
                        popupContents(e);
                        $('.sidebar-info').html(`<h4>Electrical Line</h4>
                            <div class="container"><table class="table table-striped">
                            <thead><tr><th>Properties</th><th>Value</th></tr></thead>
                            <tbody><tr><td> id </td><td> ${feature.properties.pk}</td></tr>
                            <tr><td> Line Type </td><td>${feature.properties.line_type}</td></tr>
                            <tr><td> Cable Type </td><td>${feature.properties.cable_type}</td></tr>
                            <tr><td> Pipe Cons. Material </td><td>${feature.properties.p_material}</td></tr>
                            <tr><td> Pipe Diameter </td><td>${feature.properties.p_dia_mm}</td></tr>
                            <tr><td> Phase Line </td><td>${feature.properties.phase_c}</td></tr>
                            <tr><td> Diameter of Electrical Conductor </td><td>${feature.properties.c_dia_mm}</td></tr>
                            <tr><td> Electrical Conductor Material </td><td>${feature.properties.c_material}</td></tr>`)
                    }
                })
            }
        }).addTo(map);
        var layer = new L.layerGroup().addLayer(electrical),
            selector = $('.electrical-line')
        layerToggler(selector, layer)
    })


    //telephone Internet layer
    $.getJSON("{% url 'telephoneinternet' %}", function (data) {
        var telephone = L.geoJSON(data, {
            style: telephoneStyle,
            onEachFeature: function (feature, layer) {
                layer.on({
                    click: function (e) {
                        popupContents(e);
                        $('.sidebar-info').html(`<h4>Road</h4>
                            <div class="container"><table class="table table-striped">
                            <thead><tr><th>Properties</th><th>Value</th></tr></thead>
                            <tbody><tr><td> id </td><td> ${feature.properties.pk}</td></tr>
                            <tr><td> Current Road Type </td><td>${feature.properties.road_type}</td></tr>
                            <tr><td> Road Segment </td><td>${feature.properties.road_typ_1}</td></tr>`)
                    }
                })
            }
        }).addTo(map);
        var layer = new L.layerGroup().addLayer(telephone),
            selector = $('.telephone')
        layerToggler(selector, layer)
    })




    // layer layerToggler
    function layerToggler(selector, layer) {
        selector.click(function () {
            if ($(this).prop('checked') == true) {
                map.addLayer(layer);
            } else if ($(this).prop('checked') == false) {
                map.removeLayer(layer);
            }
        });
    }

</script>
{% endblock js %}