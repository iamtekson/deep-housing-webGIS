{% extends "base.html" %}
{% load static %}
{% block title %} Webmap {% endblock title %}

{% block content %}
<!-- map view -->
<h1 class="title" leaflet-browser-print-content style="display: none;">Utility Management System: Deep Housing</h1>
<div id="map"></div>

{% include "map-control/_navbar.html" %}

{% include "map-control/functions.html" %}

{% include "map-control/add-vector.html" %}

{% include "map-control/share.html" %}

{% include "map-control/about.html" %}

{% include "map-control/side-control.html" %}

{% include "map-control/coordinate.html" %}

{% endblock content %}

{% block js %}
<script>

var waterNetworkStyle = {
        stroke: '#452',
        color: '#579fbe',
        weight: 1
    },
    boundaryStyle = {
        color: '#777',
        weight: .7,
        fill: false
    },
    boundarybuildingStyle = {
        color: 'red',
        weight: 0.5,
    },
    parkStyle = {
        color:'green',
        weight: 1,
        fill: 'green',
    },
    swimmingpollStyle = {
        color: 'blue',
        weight: .5,
        fill: 'blue'
    },
    templeStyle = {
        color: 'red',
        weight: .5,
        fill: 'red',
    },
    houseStyle = {
        color:'green',
        fill: 'red',
        weight: 3,
    }

    function otherLayers() {
        $.getJSON("{% url 'boundary' %}", function (data) {
            L.geoJSON(data, {
                style: boundaryStyle,
            }).addTo(map);
        });
        $.getJSON("{% url 'boundarybuilding' %}", function (data) {
            L.geoJSON(data, {
                style: boundarybuildingStyle
            }).addTo(map);
        });
        $.getJSON("{% url 'park' %}", function (data) {
            L.geoJSON(data, {
                style: parkStyle
            }).addTo(map);
        });
        $.getJSON("{% url 'swimmingpool' %}", function (data) {
            L.geoJSON(data, {
                style: swimmingpollStyle
            }).addTo(map);
        });
        $.getJSON("{% url 'temple' %}", function (data) {
            L.geoJSON(data, {
                style: templeStyle
            }).addTo(map);
        });
    }
    otherLayers()

    // Water layer manage
    function waterLayer() {
        $.getJSON("{% url 'waternetwork' %}", function (data) {
            var waterNetwork1 = L.geoJSON(data, {
                style: waterNetworkStyle,
                onEachFeature: function (feature, layer) {
                    layer.on({
                        click: function (e) {
                            popupContents(e);
                            $('.sidebar-info').html(`<h4>Water Network</h4>
                            <div class="container"><table class="table table-striped">
                            <thead><tr><th>Properties</th><th>Value</th></tr></thead>
                            <tbody><tr><td> Type </td><td> ${feature.properties.line_type}</td></tr>
                            <tr><td> Pipe diameter(cm) </td><td>${feature.properties.pip_dia_in}</td></tr>`)
                        }
                    })
                },
            });
            var waterNetwork = new L.layerGroup().addLayer(waterNetwork1)
            $(".water-supply").click(function () {
                if ($(this).prop('checked') == true) {
                    map.addLayer(waterNetwork);
                } else if ($(this).prop('checked') == false) {
                    map.removeLayer(waterNetwork);
                }
            });
        })
    }
    waterLayer()

$.getJSON("{% url 'house' %}", function(data){
    var houselayer1 = L.geoJSON(data, {
        style: houseStyle,
        onEachFeature: function(feature, layer) {
            layer.on({
                click: function(e){
                    popupContents(e);
                    $('.sidebar-info').html(`<h4>House</h4>
                            <div class="container"><table class="table table-striped">
                            <thead><tr><th>Properties</th><th>Value</th></tr></thead>
                            <tbody><tr><td> id </td><td> ${feature.properties.pk}</td></tr>
                            <tr><td> Current Resident </td><td>${feature.properties.curr_resid}</td></tr>
                            <tr><td> House type </td><td>${feature.properties.house_type}</td></tr>
                            <tr><td> Area (sq.m) </td><td>${feature.properties.area_sq_m_field}</td></tr>
                            <tr><td> Permanent </td><td>${feature.properties.permanent}</td></tr>
                            <tr><td> Plot number </td><td>${feature.properties.plot_no}</td></tr>`)

                }
            })
        }
    }).addTo(map);
})




</script>
{% endblock js %}